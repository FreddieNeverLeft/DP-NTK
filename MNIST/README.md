# DP-NTK code for MNIST/FashionMNIST
For CelebA, CIFAR-10 & Tabular experiments, please refer to the `IMAGE&TAB` folder.

Scripts `models/generators.py`, `data_loading.py`, `sythn_data_benchmark.py`, `util.py` (named `aux.py` originally),
the first two functions of `dp_ntk_gen.py` are taken from the repository of [DP-MERF](https://github.com/frhrdr/dp-merf/tree/main/code_balanced).

## Code Structure
- `models/`
  - `ntk.py` gives access to all NTK networks used in the code.
  - `generators.py` definitions for all generators.
- `data_loading.py` contains the dataloader for mnist/fmnist.
- `dp_ntk.py` This is the main function to run, calls `dp_ntk_mean_emb_1.py` then `dp_ntk_gen.py` (see below “how to run”).
- `dp_ntk_mean_emb_1.py` generates and saves the DP/non-DP mean embedding of sensitive data.
- `dp_ntk_gen.py` generator training for DP-NTK.
- `synth_data_benchmark.py` functions used for evaluate the synthetic data.
- `util.py` various utility functions.
- `util_logging.py` utility functions specific to logging experiments.


## How to run:

### 1) Notable Flags:
- `--seed`: value of random seed to use. we chose 1, 2, 3, 4 and 5. 
- `--tgt-eps`: the desired DP constant epsilon. the necessary noise is computed and added to mean
- `--ntk-width`: width of the FC NTK structure.

### 2) Run via Command Line

All experiments were performed with random seeds `1`,`2` `3` `4` and `5` .
Below we only list one non-private and one private run for each dataset. The other runs can be generated by changing the `seed` and `tgt_eps` arguments accordingly.

#### a) MNIST

non-DP
`python dp_ntk.py  --data dmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1`

DP
`python dp_ntk.py  --data dmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1 --tgt-eps 10`



#### b) FashionMNIST

non-DP
`python dp_ntk.py  --data fmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1`

DP
`python dp_ntk.py  --data fmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1 --tgt-eps 10`
