# DP-NTK code

## code structure
- `models/`
  - `ntk.py` gives access to all NTK networks used in the code
  - `generators.py` definitions for all generators
- `data_loading.py` contains the dataloader for mnist/fmnist
- `dp_ntk.py` This is the main function to run, calls `dp-ntk_mean_emb_1.py` then `dp-ntk_gen.py`.
- `dp-ntk_mean_emb_1.py` generates and saves the DP/non-DP mean embedding of sensitive data
- `dp-ntk_gen.py` generator step for DP-NTK 
- `synth_data_benchmark.py` functions used for evaluate the synthetic data
- `util.py` various utility functions
- `util_logging.py` utility functions specific to logging experiments


## How to run:

### 1) notable flags:
- `--seed`: value of random seed to use. we chose 1, 2, 3, 4 and 5
- `--tgt-eps`: the desired DP constant epsilon. the necessary noise is computed
- `--ntk-width`: width of the FC NTK structure

### 2) Run via command line

all experiments were performed with random seeds `1`,`2` `3` `4` and `5` 
Below we only list one nonprivate and one private run for each dataset. the other runs can be generated by changing the `seed` and `tgt_eps` arguments accordingly.

#### a) MNIST

non-DP
`python3 dp_ntk.py  --dataset dmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1`

DP
`python3 dp_ntk.py  --dataset dmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1 --tgt-eps 10`



#### b) FashionMNIST

non-DP
`python3 dp_ntk.py  --dataset fmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1`

DP
`python3 dp_ntk.py  --dataset fmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1 --tgt-eps 10`
