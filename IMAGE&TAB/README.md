# DP-NTK code for CelebA, CIFAR-10 & Tabular
For MNIST/FashionMNIST experiments, please refer to the `MNIST` folder.

Scripts `models/generators.py`, `data_loading.py`, `sythn_data_benchmark.py`, `util.py` (named `aux.py` originally),
the first two functions of `dp_ntk_gen.py` are taken from the repository of [DP-MERF](https://github.com/frhrdr/dp-merf/tree/main/code_balanced).

The script `all_aux_tab.py` is taken from the repository of [DP-HP](https://github.com/ParkLabML/DP-HP/tree/master/dp_mehp).

The script `fid_eval.py` (named `eval_fid.py` originally) is partially taken from the repository of [DP-MEPF](https://anonymous.4open.science/r/dp-gfmn/code/eval_fid.py).

## data download
In order to run celebA and tabular data, please download and unzip the 


## code structure
- `models/`
  - `ntk.py` gives access to all NTK networks used in the code.
  - `generators.py` definitions for all generators.
- `all_aux_tab.py` contains the auxillary code for tabular data.
- `data_loading.py` contains the dataloader for mnist/fmnist.
- `dp_ntk.py` This is the main function to run for the cifar10 and tabular experiments, calls `dp_ntk_mean_emb_1.py` then `dp_ntk_gen.py` (see below “how to run”).
- `dp_ntk_mean_emb_1.py` generates and saves the DP/non-DP mean embedding of sensitive data.
- `dp_ntk_gen.py` generator training for DP-NTK.
- `dp_ntk_one_class.py` This is the main function to run for CelebA experiments, calls `dp_ntk_mean_emb_1_one_class.py` then `dp_ntk_gen_one_class.py` (see below “how to run”). Is also possible to run CIFAR-10 on this file, and images will be treated as 1 class.
- `dp_ntk_mean_emb_1_one_class.py` generates and saves the DP/non-DP mean embedding of sensitive data.
- `dp_ntk_gen_one_class.py` generator training for DP-NTK.
- `fid_eval.py` various utility functions.
- `synth_data_benchmark.py` functions used for evaluate the synthetic data.
- `util.py` various utility functions.
- `util_logging.py` utility functions specific to logging experiments.


## How to run:

### 1) notable flags:
- `--seed`: value of random seed to use. we chose 1, 2, 3, 4 and 5. 
- `--tgt-eps`: the desired DP constant epsilon. the necessary noise is computed and added to mean
- `--ntk-width`: width of the FC NTK structure.

### 2) Run via command line

all experiments were performed with random seeds `1`,`2` `3` `4` and `5` .
Below we only list one non-private and one private run for each dataset. the other runs can be generated by changing the `seed` and `tgt_eps` arguments accordingly.

#### a) MNIST

non-DP
`python3 dp_ntk.py  --dataset dmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1`

DP
`python3 dp_ntk.py  --dataset dmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1 --tgt-eps 10`



#### b) FashionMNIST

non-DP
`python3 dp_ntk.py  --dataset fmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1`

DP
`python3 dp_ntk.py  --dataset fmnist --n_iter 2000 -lr 1e-2 -bs 5000 --ntk-width 800 --seed 1 --tgt-eps 10`
